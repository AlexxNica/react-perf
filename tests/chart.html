<html>
  <head>
    <title>Hello React</title>
    <script src="http://fb.me/react-0.4.1.js"></script>
    <script src="http://fb.me/JSXTransformer-0.4.1.js"></script>
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js" type="text/javascript"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type = "text/javascript">
      __VERSION__ = 0.7;
      __COMPONENT__ = "chart"
    </script>
    <script type="text/jsx">
      /** @jsx React.DOM */
var Query = React.createClass({
  handleSubmit: function() {
    var val = this.refs.searchTerm.getDOMNode().value.trim();
    if (val) {
      this.setState({term:val}, function(){
         this.props.onQuery(this.state); 
      });
    }
    return false;
  },
  handleMetric : function(){
    var val = this.refs.metric.getDOMNode().value.trim();
    console.log("Metric changed to %s", val);
    if (val) {
      this.setState({metric:val}, function(){
        this.props.onQuery(this.state);  
      });
    }
  },
  getInitialState: function(){
    return {
      metric : 'first_paint (ms)'
    }
  },
  render: function() {
    return (
      <form  class = "form-inline" onSubmit={this.handleSubmit}>
        <div class="row">
          <div class="col-lg-3">
            <input type="text" class="form-control" placeholder="Search for a component .. " ref = "searchTerm"/>
          </div>
          <div class="col-lg-3">
            <input type = "submit" class = "btn btn-primary btn" value = "Search"/>
          </div>
          <div class="col-lg-4 pull-right">
            <select class = "form-control" ref = "metric" onChange = {this.handleMetric}>
                <option>dom_content_loaded_time (seconds)</option>
                <option defaultValue>first_paint (ms)</option>
                <option>load_time (seconds)</option>
                <option>mean_frame_time (ms)</option>
            </select>
          </div>
        </div>      
      </form>
    );
  }
});


var App = React.createClass({
  getInitialState : function(){
    return {
      metric : '',
      term  : ''
    }
  },
  handleQuery : function(val){
    this.setState(val);
  },
  render: function() {
    return (
      <div class="row-fluid">
         <Query onQuery={this.handleQuery}/>
      </div>
    );
  }
});
for (var i  = 0; i < 100; i++){
      var x = document.createElement('div');
      document.body.appendChild(x);
      React.renderComponent(<App/>, x);
    }
    </script>
  </body>
</html>
